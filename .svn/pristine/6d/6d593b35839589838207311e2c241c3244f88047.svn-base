<template>
<div class="warning-made-home">
    <div class="wrap-box">
        <div class="left-box">
            <div class="top-title">
                <div class="text">天气警报选择</div>
            </div>
            <div class="left-box-main">
                <div class="types-selector weather-types">
                    <table class="line" cellspacing="0" cellpadding="0" border="0" v-for="(line,indexOfLine) in types" :key="indexOfLine">
                        <tr>
                            <td class="label">
                                {{line.label}}
                            </td>
                            <td>
                                <div class="options item flex wrap">
                                    <template v-for="indexOfItem in min(line.items.length,4)">
                                        <div class="item" v-for="item in [line.items[indexOfItem-1]]" :class="{available:item}" :key="indexOfItem">
                                            <div class="inner" v-if="item" :class="{selected:item.selected}" @click="item.selected = !item.selected">
                                                <div class="icon-wrapper">
                                                    <c-iconfont :name="item.icon" type="font" class="icon"></c-iconfont>
                                                </div>
                                                <div class="desc">{{item.desc}}</div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="top-title">
                <div class="text">已发预警信号</div>
            </div>
            <div class="left-box-main">
                <div class="alarms">
                    <alarm-item :info="{imageType:item.imageType,imageColor:item.imageColor}" v-for="(item,index) in alarms" :key="index" :item="item"></alarm-item>
                    <div class="info text-center" v-if="!alarms||!alarms.length">
                        暂无预警
                    </div>
                </div>
            </div>
        </div>

        <div class="center-box">
            <div class="top-title">
                <div class="text">天气警报制作</div>
            </div>
            <div class="content-box">
                <el-form label-width="80px">
                    <div class="form-item">
                        <div class="item-content">
                            <el-row>
                                <el-col :span="8">
                                    <el-form-item label="发布单位">
                                        <c-select v-model="form.XXX_1" options="warningType" placeholder="请选择"></c-select>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="10">
                                    <el-form-item label="发布时间">
                                        <el-date-picker v-model="form.XXX_1" type="datetime" format="yyyy-MM-dd HH:mm" value-format="yyyy-MM-dd HH:mm">
                                        </el-date-picker>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="6">
                                    <el-form-item label="期号">
                                        <el-input v-model="form.XXX_1"></el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>
                            <el-form-item label="警报类型">
                                <el-input v-model="form.XXX_1"></el-input>
                            </el-form-item>
                            <el-form-item label="警报内容">
                                <el-input v-model="form.XXX_1" type="textarea" :autosize="{ minRows: 6, maxRows: 6}"></el-input>
                            </el-form-item>
                            <el-form-item label="已发警报">
                                <el-input v-model="form.XXX_1" type="textarea" :autosize="{ minRows: 3, maxRows: 3}"></el-input>
                            </el-form-item>
                            <el-form-item label="发布渠道">
                                <div class="checkbox-box">
                                    <el-checkbox v-model="channel.selected" :label="channel.label" border v-for="(channel,index) in channels"></el-checkbox>
                                </div>
                            </el-form-item>
                            <el-form-item label="区县提醒">
                                <el-col :span="4">
                                    <el-switch v-model="form.XXX_2" active-text="是" inactive-text="否"></el-switch>
                                </el-col>
                                <el-col :span="18"></el-col>
                            </el-form-item>
                            <el-divider></el-divider>
                        </div>
                        <div class="item-content">
                            <div class="footer">
                                <el-button type="success">预览</el-button>
                                <el-button type="primary" @click="visibleDialog=true">发布</el-button>
                            </div>
                        </div>
                    </div>
                </el-form>
            </div>
        </div>
        <div class="right-box">
            <div class="top-title">
                <div class="text">天气警报发布单</div>
                <div class="actions">
                    <div class="action float-left">
                        <c-iconfont type="font" name="lishitongleifabu"></c-iconfont>
                        历史同类发布
                    </div>
                    <div class="action float-left">
                        <c-iconfont type="font" name="dayin"></c-iconfont>
                        打印
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="content-box">
                <red-head type="warning"></red-head>
            </div>
        </div>
    </div>
    <dialog-form @success="submitSuccess" title="发布产品" :visible.sync="visibleDialog" :getPayload="()=>formDialog" :confirmDisabled="true" remote="requestDialogFormAreaItemInput" v-if="formDialog">
        <template>
            <el-tabs v-model="tabsListValue1" type="card" @tab-click>
                <el-tab-pane :key="item.key" v-for="(item, index) in channels" :label="item.label" :name="item.key">
                    <div class="consult">
                        <el-row :gutter="10">
                            <el-col :span="18">
                                <div class="consult-right">
                                    <div class="top">
                                        <div class="select-all">发布内容</div>
                                    </div>
                                    <div class="consult-list">
                                        <content-weather></content-weather>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="consult-left">
                                    <div class="top">
                                        <div class="select-all">服务客户</div>
                                    </div>
                                    <div class="tree">
                                        <el-tree :data="tabTree" show-checkbox default-expand-all node-key="id" ref="tree" highlight-current :props="defaultProps"></el-tree>
                                    </div>
                                </div>
                            </el-col>
                        </el-row>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </template>
    </dialog-form>
</div>
</template>

<script>
import {
    requestGetAlarms,
    requestMakeDialogTabTreeList
} from '@/common/remote/'
import {
    transformAlarmsInfo
} from "@/common/tools/"
import AlarmItem from '../../components/alarm-item/index.vue'
import redHead from '../../components/red-head.vue'
import contentWeather from '../../components/content-weather.vue'
export default {
    components: {
        AlarmItem,
        redHead,
        contentWeather,
    },
    data() {
        return {
            form: {},
            types: [{
                "label": "台风",
                "items": [{
                    "icon": "taifengxiaoxi",
                    "desc": "台风消息",
                    "selected": false
                }, {
                    "icon": "taifengjingbao",
                    "desc": "台风警报",
                    "selected": false
                }, {
                    "icon": "taifengjinjijingbao",
                    "desc": "台风紧急警报",
                    "selected": false
                }]
            }, {
                "label": "降水类",
                "items": [{
                    "icon": "baoyu",
                    "desc": "暴雨警报",
                    "selected": false
                }, {
                    "icon": "daoxue",
                    "desc": "大雪警报",
                    "selected": false
                }, {
                    "icon": "baoxue",
                    "desc": "暴雪警报",
                    "selected": false
                }]
            }, {
                "label": "气温类",
                "items": [{
                    "icon": "lengkongqi",
                    "desc": "冷空气消息",
                    "selected": false
                }, {
                    "icon": "qianglengkongqi",
                    "desc": "强冷空气消息",
                    "selected": false
                }, {
                    "icon": "hanchao1",
                    "desc": "寒潮警报",
                    "selected": false
                }, {
                    "icon": "jiangwenbaogao",
                    "desc": "降温报告",
                    "selected": false
                }, {
                    "icon": "yanhanjingbao",
                    "desc": "严寒警报",
                    "selected": false
                }, {
                    "icon": "gaowenbaogao",
                    "desc": "高温报告",
                    "selected": false
                }, {
                    "icon": "kurejingbao",
                    "desc": "酷热警报",
                    "selected": false
                }, {
                    "icon": "diwenbaogao01",
                    "desc": "低温报告",
                    "selected": false
                }]
            }, {
                "label": "雾霾类",
                "items": [{
                    "icon": "nongwujingbao",
                    "desc": "浓雾警报",
                    "selected": false
                }, {
                    "icon": "mai",
                    "desc": "霾警报",
                    "selected": false
                }]
            }, {
                "label": "其他类",
                "items": [{
                    "icon": "dafengjingbao",
                    "desc": "大风警报",
                    "selected": false
                }, {
                    "icon": "leibaojingbao",
                    "desc": "雷暴警报",
                    "selected": false
                }]
            }],
            alarms: [],
            channels: [{
                "label": "传真",
                "key": "XXXPROP_WEATHER_MAKE_FAX",
                "selected": false
            }, {
                "label": "邮件",
                "key": "XXXPROP_WEATHER_MAKE_MAIL",
                "selected": false
            }, {
                "label": "FTP",
                "key": "XXXPROP_WEATHER_MAKE_FTP",
                "selected": false
            }, {
                "label": "短信",
                "key": "XXXPROP_WEATHER_MAKE_MSM",
                "selected": false
            }, {
                "label": "微博",
                "key": "XXXPROP_WEATHER_MAKE_WB",
                "selected": false
            }, {
                "label": "微信",
                "key": "XXXPROP_WEATHER_MAKE_WX",
                "selected": false
            }],
            visibleDialog: false,
            formDialog: {},
            // tabsList1: [{
            //         name: "邮件",
            //         id: "01",
            //         title: "邮件"
            //     },
            //     {
            //         name: "传真",
            //         id: "02",
            //         title: "传真"
            //     },
            //     {
            //         name: "大喇叭",
            //         id: "03",
            //         title: "大喇叭"
            //     },
            //     {
            //         name: "微博",
            //         id: "04",
            //         title: "微博"
            //     }
            // ],
            tabsListValue1: "XXXPROP_WEATHER_MAKE_FAX",
            defaultProps: {
                children: "children",
                label: "label"
            },
            tabTree: [],
            // end of data
        };
    },
    mounted() {
        requestGetAlarms().then(res => {
            this.alarms = res.data.list.map(e => ({
                ...transformAlarmsInfo({
                    type: e.XXXPROP_ALARMS_TYPE,
                    level: e.XXXPROP_ALARMS_LEVEL
                }),
                content: e.XXXPROP_ALARMS_CONTENT,
                time: e.XXXPROP_ALARMS_TIME,
                ...e
            }))
        })
        requestMakeDialogTabTreeList().then(res => {
            this.tabTree = res.data.list;
        });
    },
    methods: {
        handleClick(tab, event) {
            console.log(tab, event);
        },
        min(val, min) {
            return val < min ? min : val
        },
        submitSuccess() {

        }
    }
};
</script>

<style scoped>
.warning-made-home {
    background: #f6f6f6;
    padding: 15px 20px 0 15px;
    height: 100%;
    box-sizing: border-box;

    .wrap-box {
        display: flex;
        justify-content: space-between;

        .left-box {
            width: 420px;
            position: relative;
            background: #fff;

            .content-box {
                padding: 10px 20px 0;

                .tree-box {
                    margin-top: 23px;
                }
            }

            .warning-tool {
                margin-top: 14px;
            }
        }
    }

    .center-box {
        flex: 1;
        background: #fff;
        margin-left: 18px;

        .content-box {
            padding: 0 30px 33px;

            .item-title {
                padding: 20px 0;
                font-size: 16px;
            }

            .item-content {
                padding: 20px 20px;
                font-size: 14px;

                .checkbox-box {
                    .el-checkbox {
                        margin: 5px 5px !important;
                    }
                }

                .footer {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }
            }
        }
    }

    .right-box {
        /* flex: 0.5; */
        width: 620px;
        background: #fff;
        margin-left: 22px;

        .content-box {
            padding: 10px 20px 0 20px;
        }
    }
}

.top-title {
    padding: 20px;
    border-bottom: 1px solid rgba(228, 231, 237, 1);
    display: flex;
    justify-content: space-between;

    .text {
        font-size: 18px;
        font-family: Microsoft YaHei;
        font-weight: 400;
        color: rgba(48, 49, 51, 1);
    }

    .actions {
        text-align: right;

        .action,
        .iconfont {
            font-size: 14px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: rgba(144, 147, 153, 1);
        }

        .action {
            margin-left: 22px;
        }
    }
}

.no-border {
    border-bottom: none;
}

.title {
    font-size: 14px;
    font-family: Microsoft YaHei;
    color: rgba(96, 98, 102, 1);
}

.consult {
    .top {
        background: rgba(246, 247, 251, 1);
        border: 1px solid rgba(228, 231, 237, 1);
        border-radius: 5px 5px 0 0;

        .select-all {
            font-size: 13px;
            padding: 14px;
        }
    }
}
</style>
<style lang="postcss">
.warning-made-home {
  .left-box {
    .el-input__inner {
      border-radius: 16px;
    }
  }
}
</style>
