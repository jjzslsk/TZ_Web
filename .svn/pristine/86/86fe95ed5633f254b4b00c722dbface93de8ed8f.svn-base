<template>
  <div class="product-made-home">
    <div class="wrap-box">
      <div class="left-box">
        <!-- <common-left-tree
          @success="submitSuccess"
          title="产品导航"
          :isHeader='true'
          :data="treeData"
          @click-item="onTreeClickItem"
          :defaultExpandAll="true"
        >
          <div slot="head-search" class="head-search">
            <el-input placeholder="请输入内容" prefix-icon="el-icon-search" v-model="searchText"></el-input>
          </div>
          <div slot="append" class>
            <div>
              <span class="title">分类操作：</span>
              <common-left-tree-actions
                @success="submitSuccess"
                :lastItemClicked="lastItemClicked"
                @append="onTreeAppend"
                @edit="onTreeEdit"
                @delete="onTreeDelete('requestProductInfoTpyeTreeDel')"
              ></common-left-tree-actions>
            </div>
            <div>
              <span class="title">产品操作：</span>
              <common-left-tree-actions
                @success="submitSuccess"
                :lastItemClicked="lastItemClicked"
                @append="onTreeAppendMinor"
                @edit="onTreeEditMinor"
                @delete="onTreeDeleteMinor('requestProductClassTreeDelMinor')"
              ></common-left-tree-actions>
            </div>
          </div>
        </common-left-tree> -->
      <common-left-tree @success="submitSuccess" class="left-tree" title="产品导航" :searchText='searchText' :isHeader='true' :data="treeData" @click-item="onTreeClickItem" :defaultExpandAll="true">
        <div slot="head-search" class="head-search">
            <el-input placeholder="请输入内容" prefix-icon="el-icon-search" v-model="searchText"></el-input>
        </div>
      <div slot="append" class="">
        <div>
        <span class="title">分类操作：</span><common-left-tree-actions @success="submitSuccess" :lastItemClicked="lastItemClicked" @append="onTreeAppend" @edit="onTreeEdit" @delete="delProductClassify()"></common-left-tree-actions>
        </div>
        <div>
        <span class="title">产品操作：</span><common-left-tree-actions @success="submitSuccess" :lastItemClicked="lastItemClicked" @append="onTreeAppendMinor" @edit="onTreeEditMinor" @delete="templateProductClassify()"></common-left-tree-actions>
        </div>
      </div>
      </common-left-tree> 
      </div>

      <!-- 产品分类 -->
      <dialog-form
        @success="submitSuccess"
        :title="dialogTitle + '产品分类'"
        :visible.sync="visibleDialogFormLeftTree"
        :getPayload="()=>formLeftTree"
        :confirmDisabled="!formLeftTree.name||formLeftTree.name===undefined"
        remote="requestDialogFormProductInfoTpyeInput"
        v-if="formLeftTree"
      >
        <!-- <template v-slot:default="{ form }"> -->
        <template>
          <el-form-item label="分类名称" label-width="120px">
            <el-input v-model="formLeftTree.name" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="上级分类" label-width="120px">
            <el-select v-model="formLeftTree.pid" placeholder="请选择">
              <el-option
                v-for="item in treeDataList"
                :label="item.label"
                :value="item.id"
                :key="item.id"
              ></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="排序" label-width="120px">
            <el-input v-model="formLeftTree.sort" autocomplete="off"></el-input>
          </el-form-item>
        </template>
      </dialog-form>

      <!-- 产品 -->
      <dialog-form
        @success="submitSuccess"
        :title="dialogTitle + '产品'"
        :visible.sync="visibleDialogformLeftTreeMinor"
        :getPayload="()=>formLeftTreeMinor"
        :confirmDisabled="!formLeftTreeMinor.name"
        remote="requestProductInfoSave"
        v-if="formLeftTreeMinor"
      >
        <!-- <template v-slot:default="{ form }"> -->
        <template>
          <el-form-item label="产品分类" label-width="120px">
            <el-select v-model="formLeftTreeMinor.productTypeId" placeholder="请选择">
              <el-option
                v-for="item in treeDataList"
                :label="item.label"
                :value="item.id"
                :key="item.id"
              ></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="产品名称" label-width="120px">
            <el-input v-model="formLeftTreeMinor.name" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="文本格式" label-width="120px">
            <el-radio-group v-model="formLeftTreeMinor.type">
              <el-radio label="word"></el-radio>
              <el-radio label="txt"></el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item label="唯一标识" label-width="120px">
            <el-input v-model="formLeftTreeMinor.code" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="排序" label-width="120px">
            <el-input v-model="formLeftTreeMinor.sort" autocomplete="off"></el-input>
          </el-form-item>
        </template>
      </dialog-form>

      <!-- 服务用户绑定 -->
      <dialog-form
        @success="submitSuccess"
        title="服务用户绑定"
        :visible.sync="visibleDialogTree"
        :getPayload="()=>formItem"
        :confirmDisabled="true"
        remote="requestDialogFormAreaItemInput"
        v-if="formTabTree"
      >
        <template>
          <el-tabs v-model="tabsListValue" type="card" @tab-click="handleClick">
            <el-tab-pane
              :key="item.name"
              v-for="(item, index) in tabsList"
              :label="item.name"
              :name="item.name"
            >
              <el-tree
                :data="userTreeData"
                show-checkbox
                default-expand-all
                node-key="id"
                ref="tree"
                highlight-current
                :props="defaultProps"
              ></el-tree>
            </el-tab-pane>
          </el-tabs>
        </template>
      </dialog-form>

      <!-- 参考资料绑定 -->
      <dialog-form
        @success="submitSuccess"
        title="参考资料绑定"
        :visible.sync="visibleDialogConsult"
        :getPayload="()=>formItem"
        :confirmDisabled="true"
        remote="requestDialogFormAreaItemInput"
        v-if="formConsult"
      >
        <template>
          <el-tabs v-model="tabsListValue" type="card" @tab-click="handleClick">
            <el-tab-pane
              :key="item.name"
              v-for="(item, index) in tabsList1"
              :label="item.title"
              :name="item.name"
            >
              <div class="consult">
                <el-row :gutter="10">
                  <el-col :span="6">
                    <div class="consult-left">
                      <div class="top">
                        <div class="select-all">
                          <el-checkbox v-model="form">参考资料</el-checkbox>
                        </div>
                      </div>
                      <div class="tree">
                        <el-tree
                          :data="tabTree"
                          show-checkbox
                          default-expand-all
                          node-key="id"
                          ref="tree"
                          highlight-current
                          :props="defaultProps"
                        ></el-tree>
                      </div>
                    </div>
                  </el-col>
                  <el-col :span="18">
                    <div class="consult-right">
                      <div class="consult-list">
                        <template>
                          <el-table :data="tableData" style="width: 100%">
                            <el-table-column prop="name" label="素材名称" width="180"></el-table-column>
                            <el-table-column prop="material" label="素材编号" width="180"></el-table-column>
                            <el-table-column prop="type" label="素材类型"></el-table-column>
                            <el-table-column prop="num" label="显示顺序" width="100"></el-table-column>
                            <el-table-column fixed="right" label="操作" width="100">
                              <template slot-scope="scope">
                                <i class="el-icon-bottom"></i>
                                <i class="el-icon-top"></i>
                                <i class="el-icon-delete"></i>
                                <!-- <el-button type="text" size="small">编辑</el-button> -->
                              </template>
                            </el-table-column>
                          </el-table>
                        </template>
                      </div>
                    </div>
                  </el-col>
                </el-row>
              </div>
            </el-tab-pane>
          </el-tabs>
        </template>
      </dialog-form>

      <!-- 产品属性 -->
      <div class="center-box">
        <div class="top-title">
          <div class="text">产品属性</div>
        </div>
        <!-- {{InfoForm}}2 -->
        <div class="content-box" v-if="editState">
          <el-form label-width="80px">
            <div class="form-item">
              <div class="item-title">产品信息</div>
              <!-- {{lastItemClicked}} -->

              <!-- templateIds{{templateIds}} -->
              <div class="item-content">
                <el-form-item label="产品标识">
                  <el-input v-model="InfoForm.code" disabled=""></el-input>
                </el-form-item>
                <el-form-item label=" 产品名称">
                  <el-input v-model="InfoForm.name" disabled></el-input>
                </el-form-item>
                <el-divider></el-divider>
              </div>
              <div class="item-title">设置</div>
              <div class="item-content">
                <el-form-item label="发布方式">
                  <div class="checkbox-box">
                    <el-checkbox-group v-model="InfoForm.publishChannel" size="small">
                      <el-checkbox v-for="item in wayTpye" :label="item.id" :key="item.id" border>{{item.name}}</el-checkbox>
                    </el-checkbox-group>
                  </div>
                </el-form-item>
                <el-form-item label="班次">
                  <el-radio-group v-model="InfoForm.jobId">
                    <el-radio label="SX">首席</el-radio>
                    <el-radio label="DQYB">短期预报</el-radio>
                    <el-radio label="DLYB">短临预报</el-radio>
                  </el-radio-group>
                </el-form-item>
                <el-form-item label="预约发布">
                  <el-col :span="4">
                    <el-switch v-model="InfoForm.subscribePublish" active-text="开" inactive-text="关"></el-switch>
                  </el-col>
                  <el-col :span="6">
                    <el-time-picker placeholder="预约时间" format="HH:mm" value-format="HH:mm" v-model="InfoForm.subscribeTime" style="width: 100%;"></el-time-picker>
                  </el-col>
                  <el-col :span="12"></el-col>
                </el-form-item>
                <el-form-item label="制作提醒">
                  <el-col :span="4">
                    <el-switch v-model="InfoForm.remindMake"></el-switch>
                  </el-col>
                  <el-col :span="18"></el-col>
                </el-form-item>
                <el-form-item label="制作时间">
                  <template>
                    <el-tabs v-model="timeTab" type="border-card" @tab-click="handleClick">
                      <el-tab-pane label="月" name="first">
                        <template>
                          <el-checkbox
                            :indeterminate="isIndeterminate"
                            v-model="checkAllMonth"
                            @change="handleCheckAllChangeMonth"
                          >全选</el-checkbox>
                          <div style="margin: 0px 0 0 0;"></div>
                          <el-checkbox-group
                            v-model="InfoForm.ruleMonth"
                            @change="handleCheckedProductChangeMonth"
                          >
                            <el-checkbox v-for="item in attTimeMonth" :label="item" :key="item">{{item}}</el-checkbox>
                          </el-checkbox-group>
                        </template>
                      </el-tab-pane>
                      <!-- <el-tab-pane label="周" name="third">
                        <template>
                          <el-checkbox
                            :indeterminate="isIndeterminate"
                            v-model="checkAllWeek"
                            @change="handleCheckAllChangeWeek"
                          >全选</el-checkbox>
                          <div style="margin: 0px 0 0 0;"></div>
                          <el-checkbox-group
                            v-model="InfoForm.ruleWeek"
                            @change="handleCheckedProductChangeWeek"
                          >
                            <el-checkbox v-for="item in attTimeWeek" :label="item" :key="item">{{item}}</el-checkbox>
                          </el-checkbox-group>
                        </template>
                      </el-tab-pane> -->
                      <el-tab-pane label="周1" name="third1">
                        <template>
                          <el-checkbox
                            :indeterminate="isIndeterminate"
                            v-model="checkAllWeek"
                            @change="handleCheckAllChangeWeek"
                          >全选</el-checkbox>
                          <div style="margin: 0px 0 0 0;"></div>
                          <el-checkbox-group
                            v-model="InfoForm.ruleWeek"
                            @change="handleCheckedProductChangeWeek"
                          >
                            <el-checkbox v-for="item in attTimeWeek" :label="item" :key="item">{{item}}</el-checkbox>
                          </el-checkbox-group>
                        </template>
                      </el-tab-pane>
                      <el-tab-pane label="日" name="second">
                        <template>
                          <el-checkbox
                            :indeterminate="isIndeterminate"
                            v-model="checkAllDay"
                            @change="handleCheckAllChangeDay"
                          >全选</el-checkbox>
                          <div style="margin: 0px 0 0 0;"></div>
                          <el-checkbox-group
                            v-model="InfoForm.ruleDay"
                            @change="handleCheckedProductChangeDay"
                          >
                            <el-checkbox v-for="item in attTimeDay" :label="item" :key="item">{{item}}</el-checkbox>
                          </el-checkbox-group>
                        </template>
                      </el-tab-pane>
                      <el-tab-pane label="时" name="fourth">
                        <template>
                          <el-checkbox
                            :indeterminate="isIndeterminate"
                            v-model="checkAllTime"
                            @change="handleCheckAllChangeTime"
                          >全选</el-checkbox>
                          <div style="margin: 0px 0 0 0;"></div>
                          <el-checkbox-group
                            v-model="InfoForm.ruleTime"
                            @change="handleCheckedProductChangeTime"
                          >
                            <el-checkbox v-for="item in attTimeTime" :label="item" :key="item">{{item}}</el-checkbox>
                          </el-checkbox-group>
                        </template>
                      </el-tab-pane>
                      <el-tab-pane label="分" name="fourth1">
                        <template>
                          <el-checkbox
                            :indeterminate="isIndeterminate"
                            v-model="checkAllMinute"
                            @change="handleCheckAllChangeMinute"
                          >全选</el-checkbox>
                          <div style="margin: 0px 0 0 0;"></div>
                          <el-checkbox-group
                            v-model="InfoForm.ruleMinute"
                            @change="handleCheckedProductChangeMinute"
                          >
                            <el-checkbox v-for="item in attTimeMinute" :label="item" :key="item">{{item}}</el-checkbox>
                          </el-checkbox-group>
                        </template>
                      </el-tab-pane>
                    </el-tabs>
                  </template>
                </el-form-item>
                <el-divider></el-divider>
                <div class="footer">
                  <el-button type="primary" size="small" @click="save()">保存</el-button>
                  <el-button type="primary" size="small" @click="onTab()">服务用户绑定</el-button>
                  <el-button type="primary" size="small" @click="onConsult()">参考资料绑定</el-button>
                </div>
              </div>
            </div>
          </el-form>
        </div>
        <div class="content-box" v-else>
          <div class="hint"></div>
          请选择产品分类下的产品进行编辑操作
        </div>
      </div>

      <!-- 模板绑定 -->
      <div class="right-box">
        <div class="top-title">
          <div class="text">模板绑定</div>
        </div>
        <div class="content-box">
          <el-row>
            <el-button plain v-for="item in templateData" :key="item.id" @click="butClick(item)">{{item.label}}</el-button>
          </el-row>
        </div>
        <el-divider></el-divider>
        <div class="footer">
          <el-button type="primary" size="small" @click="employTemplate()">使用</el-button>
        </div>
      </div>
      
    </div>
  </div>
</template>

<script>
import {
  requestProductInfoTpyeTreeDel,
  requestProductInfoTpyeTreeList,
  requestProductTabTreeList,
  requestProductTabsList,
  requestProductClassTreeList,
  requestProductInfoTreeItem,
  requestProductInfoSave,
  requestServiceUserTreeList
} from "@/remote/";
import PageOffice from "@/components/page-office/";
import {
  common,
  witchCommonList,
  withCommonLeftTree
} from "../../mixins/index";
import { mapActions, mapGetters } from "vuex";
const itemOptionsMonth = ["1", "2", "3", "4", "5", "6", "7","8","9","10","11","12"];
const itemOptionsWeek = ["1", "2", "3", "4", "5"];
const itemOptionsDay = ["1", "2", "3", "4", "5", "6", "7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"];
const itemOptionsTime = ["1", "2", "3", "4", "5", "6", "7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"];
const itemOptionsMinute = ["1", "2", "3", "4", "5", "6", "7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"];
export default {
  mixins: [common, witchCommonList, withCommonLeftTree],
  components: {
    PageOffice
  },
  data() {
    return {
      userTreeData:[],
      timeTab:'second',
      templateIds:null,
      editState:false,
      // itemOptionsDay: ['上海', '北京', '广州', '深圳'],
      tableData: [
        {
          material: "MaxTemp",
          name: "最高气温",
          num:'2',
          type: "图片"
        },
        {
          material: "MaxTemp",
          name: "最低气温",
          num:'2',
          type: "图片"
        },
        {
          material: "MaxTemp",
          name: "最大风",
          num:'2',
          type: "图片"
        },
        {
          material: "MaxTemp",
          name: "1小时降雨",
          num:'2',
          type: "图片"
        }
      ], 

      checkAllDay: false,
      checkAllWeek: false,
      checkAllMonth: false,
      checkAllTime: false,
      checkAllMinute: false,
      // checkedProductDay: ["2", "3"],
      // InfoForm.ruleWeek: ["2", "4"],
      // InfoForm.ruleMonth: ["2", "5"],
      // checkedProductTime: ["2", "6"],
      // checkedProductMinute: ["2", "7"],
      attTimeDay: itemOptionsDay,
      attTimeMonth: itemOptionsMonth,
      attTimeWeek: itemOptionsWeek,
      attTimeTime: itemOptionsTime,
      attTimeMinute: itemOptionsMinute,
      isIndeterminate: true,

      form: null,
      defaultProps: {
        children: "children",
        label: "label"
      },
      tabTree: [],
      menuData: [],
      userOrgId: null,
      visibleDialogFormItemClassify: false,
      visibleDialogFormItemProduct: false,
      formItem: null,
      radioType: "word",
      checkList: ["值班记录", "每日预报产品"],
      topTitle: "",
      searchText: "",
      tabsListValue: "微信",
      tabsList: [],
      tabsList1: [
        {name:'图片资料',id:'01',title:'图片资料'},
        {name:'文字资料',id:'02',title:'文字资料'},
      ],
      wayTpye: [
        {name:'微博',id:'wb'},
        {name:'微信',id:'wx'},
        {name:'短信',id:'dx'},
        {name:'邮件',id:'yj'},
        {name:'传真',id:'cz'},
        {name:'FTP',id:'FTP'},
        {name:'LED显示屏',id:'led'},
        {name:'多媒体显示屏',id:'leds'},
      ],
      treeData: [],
      treeDataList: [],
      templateData:[],
      InfoForm:{
        publishChannel:[],
        ruleMonth:[],
        ruleDay:[],
        ruleTime:[],
        ruleMinute:[],
      },
    };
  },
  watch: {
    searchText(val) {
      this.$refs.tree.filter(val);
    },
    'lastItemClicked.type':{
      handler(val, oldVal){
        if(val == 'product'){
          this.editState = true
        }else{
          this.editState = false
        }
        },
    },
  },
  mounted() {
    this.requestData();
  },
  computed:{
      ...mapGetters(['accountOrgId']),
    },
  methods: {
    employTemplate(){
      if (this.editState == false || this.templateIds == null) {
          this.$message.warning("请选择产品和对应绑定的模块！");
          return;
      }else {
        requestProductInfoSave({id:this.lastItemClicked.id,templateId:this.templateIds}).then(res=>{
            this.InfoForm = {}
            this.lastItemClicked = {}
            this.templateIds = null
        })
      }
      // this.InfoForm.templateId = this.templateIds
    },
    butClick(item){
      console.log(item)
      if (this.editState == false) {
          this.$message.warning("请选择产品！");
          return;
      }
      this.InfoForm.templateId = item.id
      this.templateIds = item.id
    },
    save(){
      if (this.lastItemClicked == null) {
          this.$message.warning("请选择产品！");
          return;
      }else{
        let param = {
          id:this.InfoForm.id,
          productTypeId:this.InfoForm.productTypeId,
          code:this.InfoForm.code,
          name:this.InfoForm.name,
          type:this.InfoForm.type,
          templateId:this.InfoForm.templateId,
          jobId:this.InfoForm.jobId,
          publishChannel:this.InfoForm.publishChannel,
          sort:this.InfoForm.sort,
          subscribePublish:this.InfoForm.subscribePublish == true ? 1:0,
          subscribeTime:this.InfoForm.subscribeTime,
          remindMake:this.InfoForm.remindMake == true ? 1:0,
          ruleMonth:this.InfoForm.ruleMonth,
          ruleDay:this.InfoForm.ruleDay,
          ruleTime:this.InfoForm.ruleTime,
          ruleMinute:this.InfoForm.ruleMinute,
          // templateId:
        }
        requestProductInfoSave(param).then(res=>{
          // this.submitSuccess()
        })
      }
    },
    onTab() {
        // this.formLeftTree = this.getFormItemLeftByInputItem();
        this.formTabTree = true;
        this.visibleDialogTree = true;
        console.log('绑定')
        requestProductInfoTreeItem({id:this.lastItemClicked.id}).then(res=>{
          this.InfoForm = {
          publishChannel:res.data.list[0].publishChannel == null ? []:res.data.list[0].publishChannel,
          }

          this.tabsList = []
          this.InfoForm.publishChannel.forEach(i=>{
            this.wayTpye.forEach(item =>{
              if(i == item.id){
                this.tabsList.push(item)
              }
            })
          })
        })

        requestServiceUserTreeList().then(res => {
            this.userTreeData = res.data.list;
        });
    },
    onConsult() {
        this.$message.warning("功能开发中！");
        // this.formConsult = true;
        // this.visibleDialogConsult = true;
        // console.log('新增1')
    },
    handleCheckAllChangeMonth(val) {
      this.InfoForm.ruleMonth = val ? itemOptionsMonth : [];
      this.isIndeterminate = false;
    },
    handleCheckedProductChangeMonth(value) {
      let checkedCount = value.length;
      this.checkAllMonth = checkedCount === this.attTimeMonth.length;
      this.isIndeterminate =
        checkedCount > 0 && checkedCount < this.attTimeMonth.length;
    },
    handleCheckAllChangeWeek(val) {
      this.InfoForm.ruleWeek = val ? itemOptionsWeek : [];
      this.isIndeterminate = false;
    },
    handleCheckedProductChangeWeek(value) {
      let checkedCount = value.length;
      this.checkAllWeek = checkedCount === this.attTimeWeek.length;
      this.isIndeterminate =
        checkedCount > 0 && checkedCount < this.attTimeWeek.length;
    },
    handleCheckAllChangeDay(val) {
      this.InfoForm.ruleDay = val ? itemOptionsDay : [];
      this.isIndeterminate = false;
    },
    handleCheckedProductChangeDay(value) {
      let checkedCount = value.length;
      this.checkAllDay = checkedCount === this.attTimeDay.length;
      this.isIndeterminate =
        checkedCount > 0 && checkedCount < this.attTimeDay.length;
    },
    handleCheckAllChangeTime(val) {
      this.InfoForm.ruleTime = val ? itemOptionsTime : [];
      this.isIndeterminate = false;
    },
    handleCheckedProductChangeTime(value) {
      let checkedCount = value.length;
      this.checkAllTime = checkedCount === this.attTimeTime.length;
      this.isIndeterminate =
        checkedCount > 0 && checkedCount < this.attTimeTime.length;
    },
    handleCheckAllChangeMinute(val) {
      this.InfoForm.ruleMonth = val ? itemOptionsMinute : [];
      this.isIndeterminate = false;
    },
    handleCheckedProductChangeMinute(value) {
      let checkedCount = value.length;
      this.checkAllMinute = checkedCount === this.attTimeMinute.length;
      this.isIndeterminate =
        checkedCount > 0 && checkedCount < this.attTimeMinute.length;
    },

    handleClick(tab, event) {
      console.log(tab, event);
    },
    //初始化页面数据
    requestData() {
      this.getAccountInfo().then(res => {
        //获取当前用户机构id
        // if (res.success && res.data) {
        //   this.userOrgId = res.data.orgId;
        // }
      });
      requestProductInfoTpyeTreeList().then(res => {
        this.treeData = res.data.list;
        this.treeDataList = [];
        this.treeOfList(res.data.list);
      });
      requestProductTabTreeList().then(res => {
        this.tabTree = res.data.list;
      });
      requestProductTabsList().then(res => {
        // this.tabsList = res.data.list;
        this.tabsList = [
          {name:'短信',id:'01',title:'短信'},
          {name:'邮件',id:'02',title:'邮件'},
        ]
      });

      requestProductClassTreeList().then(res => {
          this.templateData = [],
          this.templateOfList(res.data.list)
        });

    },
       templateOfList(tree){
          tree.map(item => {
            if(true){
              console.log(item)
            }
            this.templateData.push(item)
            if(item.children){
              this.templateOfList(item.children)
            }
          })
      },
    submitSuccess(res) {
      this.lastItemClicked = undefined
      this.templateIds = null
      this.requestData();
    },
    ...mapActions(["gotAccountInfo", "getAccountInfo", "getMenuInfo"]),
    filterNode(value, data) {
      if (!value) return true;
      return data.label.indexOf(value) !== -1;
    },
    treeOfList(tree) {
      tree.map(item => {
        if(item.type == 'productType'){
          this.treeDataList.push(item);
        }
        if (item.children) {
          this.treeOfList(item.children);
        }
      });
    },
    delItemProductClassify() {
      let vm = this;
      if (vm.topTitle) {
        requestProductInfoTpyeTreeDel({
          id: vm.topTitle
        }).then(res => {
          vm.$message.success("删除成功!");
          // this.$refs.table.fetchData();
        });
      }
    },
    saveModule() {},
    handleNodeClick(data) {
      let vm = this;
      console.log('ddd:',data);
      vm.topTitle = "";
      vm.topTitle = data.label;
      if(data.type == 'product'){
        requestProductInfoTreeItem({id:data.id}).then(res=>{
          console.log(res)
          this.InfoForm = {
          ...res.data.list[0],
          subscribePublish: res.data.list[0].subscribePublish == 1 ? true:false,
          remindMake: res.data.list[0].remindMake == 1 ? true:false,
          publishChannel:res.data.list[0].publishChannel == null ? []:res.data.list[0].publishChannel,
          }
        })
      }
    },

    inputItemClassifyEdit(item) {
      if (!this.formItem) {
        alert("请选择父节点");
        return;
      }
      this.formItem = this.getFormItemByInputItemClassify(item);
      this.visibleDialogFormItemClassify = true;
    },

        // 增补节点（新增子节点）
        onTreeAppendMinor() {
            const {
                lastItemClicked
            } = this;
            if (lastItemClicked == undefined) {
                this.$message.warning("请先选择要添加的父节点!");
                return;
            }else
            if (lastItemClicked.type !== 'productType') {
                this.$message.warning("请选择正确的节点!");
                return;
            }else{

            }
            this.formLeftTreeMinor = this.getFormItemLeftByInputItemMinor();
            this.visibleDialogformLeftTreeMinor = true;
            this.dialogTitle = '新增'
            console.log('新增112', this.formLeftTreeMinor)
        },
        
      onTreeEditMinor() {
          const {
            lastItemClicked
        } = this;
        if (lastItemClicked.type !== 'product') {
                this.$message.warning("请选择正确的产品");
                return;
            }
        this.formLeftTreeMinor = this.getFormItemLeftByInputItemMinor(lastItemClicked);
        this.visibleDialogformLeftTreeMinor = true;
        this.dialogTitle = '编辑'
        console.log('编辑11', this.formLeftTreeMinor)
      },

      delProductClassify() {
            const {
                lastItemClicked,
            } = this;
            // if (lastItemClicked.moduleType !== 'productType') {
            //     this.$message.warning("请选择正确的产品分类");
            //     return;
            // }

            requestProductInfoTpyeTreeDel({id: lastItemClicked.id}).then(res => {
                this.visibleDialog = false;
                res.message && this.$message.success(res.message);
                this.requestData()
            })
        },

    inputItemClassify(item) {
      this.formItem = this.getFormItemByInputItemClassify(item);
      this.visibleDialogFormItemClassify = true;
    },
    inputItemProduct(item) {
      this.formItem = this.getFormItemByInputItemProduct(item);
      this.visibleDialogFormItemProduct = true;
    },
    getFormItemByInputItemClassify(item = {}) {
      this.getAccountInfo().then(res => {
        //获取当前用户机构id
        // if (res.success && res.data) {
        //   this.formItem.orgId = res.data.orgId;
        // }
      });
      const { lastItemClicked } = this;
      const lastKeyItemClicked = lastItemClicked && lastItemClicked.id;
      console.log(lastItemClicked);
      return {
        // "XXXPROP_ORGAN_id": "",
        remark: "123",
        pid: "",
        name: "",
        sort: "",
        orgId: ""
        // "XXXPROP_ORGAN_4": lastItemClicked && (lastItemClicked.XXXPROP_ORGAN_4 || 0) + 1 + "",
        // "XXXPROP_ORGAN_5": lastKeyItemClicked,
        // lastItemClicked,
        // ...item
      };
    },
    getFormItemLeftByInputItem(item) {
      const { lastItemClicked } = this;
      console.log("lastItemClicked:", lastItemClicked);
      console.log("item:", item);
      return item
        ? {
            id: item.id,
            name: item.label,
            sort: item.sort,
            pid: item.parentId,
            orgId: this.accountOrgId
          }
        : {
            name: "",
            sort: "",
            // pid: lastItemClicked.pid,
            orgId: this.accountOrgId
            // remark:"",
          };
    },
    getFormItemLeftByInputItemMinor(item) {
      const { lastItemClicked } = this;
      console.log("lastItemClicked:", lastItemClicked);
      console.log("item:", item);
      return item ?  {
          // name:'',
          // sort:'',
          // pid:item.pid == null 
          ...item,
          orgId:this.accountOrgId
          } 
          : {
          productTypeId:lastItemClicked.id,
          name: '',
          sort: '',
          // pid: item.pid,
          orgId:this.accountOrgId
      };
    },
    getFormItemByInputItemProduct(item = {}) {
      const { lastItemClicked } = this;
      const lastKeyItemClicked = lastItemClicked && lastItemClicked.id;
      return {
        // "XXXPROP_ORGAN_id": "",
        XXXPROP_ORGAN_1: "",
        XXXPROP_ORGAN_2: "",
        XXXPROP_ORGAN_3: "",
        XXXPROP_ORGAN_4:
          lastItemClicked && (lastItemClicked.XXXPROP_ORGAN_4 || 0) + 1 + "",
        XXXPROP_ORGAN_5: lastKeyItemClicked,
        XXXPROP_ORGAN_6: "",
        lastItemClicked,
        ...item
      };
    }
  }
};
</script>

<style lang="postcss" scoped>
.product-made-home {
  background: #f6f6f6;
  padding: 15px 20px 0 0;
  height: 100%;
  box-sizing: border-box;
  .wrap-box {
    display: flex;
    justify-content: space-between;
    .left-box {
      width: 280px;
      position: relative;
      background: #fff;
      .content-box {
        padding: 10px 20px 0;
        .tree-box {
          margin-top: 23px;
        }
      }
      .tool-box {
        padding: 30px 20px;
        position: relative;
        bottom: 0px;
        .line-interval {
          width: 100%;
          height: 1px;
          background: #e4e7ed;
          margin-bottom: 30px;
        }
        .classify-tool {
          display: flex;
          justify-content: space-between;
          height: 35px;
          line-height: 35px;
          .title {
            font-size: 14px;
            font-family: Microsoft YaHei;
            color: rgba(96, 98, 102, 1);
          }
          .icon-boxborder: 1px solid rgba(235, 238, 245, 1);
          border-radius: 6px;
          width: 165px;
          .iconfont {
            display: inline-block;
            width: 30%;
            text-align: center;
            font-size: 15px;
            border-right: 1px solid #ebeef5;
          }
          .iconfont:last-child {
            border-right: none;
          }
          .tianjia {
            color: #67c241;
          }
          .bianji {
            color: #409eff;
          }
          .shanchu {
            color: #f46d6a;
          }
        }
      }
      .product-tool {
        margin-top: 14px;
      }
    }
  }
  .center-box {
    flex: 1;
    background: #fff;
    margin-left: 18px;
    .content-box {
      padding: 0 30px 33px;
      .item-title {
        padding: 20px 0;
        font-size: 16px;
      }
      .item-content {
        padding: 20px 20px;
        font-size: 14px;
        .checkbox-box {
          /* display: flex;
              flex-wrap:wrap;
              align-content:flex-start; */
          .el-checkbox {
            margin: 5px 5px !important;
          }
        }
        .footer {
          display: flex;
          justify-content: center;
          align-items: center;
        }
      }
      .hint {
        margin: 40px;
      }
    }
  }
  .right-box {
    flex: 0.5;
    background: #fff;
    margin-left: 22px;
    .content-box {
      padding: 10px 20px 0 20px;
      .el-button {
        margin: 5px 5px !important;
      }
    }
    .footer {
      display: flex;
      justify-content: center;
      align-items: center;
    }
  }
}
.top-title {
  padding: 20px;
  border-bottom: 1px solid rgb(26, 87, 211);
  display: flex;
  justify-content: space-between;
  .text {
    font-size: 18px;
    font-family: Microsoft YaHei;
    font-weight: 400;
    color: rgba(48, 49, 51, 1);
  }
}
.no-border {
  border-bottom: none;
}

.title {
  font-size: 14px;
  font-family: Microsoft YaHei;
  color: rgba(96, 98, 102, 1);
}
.common-left {
  width: 100% !important;
  margin-right: 0;
}
.common-left .el-card {
  border: 0px solid #ebeef5;
}
.common-left-tree-actions {
  display: inline-block;
  text-align: center;
  padding: 1em 0;
}
.left-box .text {
  margin-top: 15px;
}
.consult {
  .consult-left {
    .top {
      background: rgba(246, 247, 251, 1);
      border: 1px solid rgba(228, 231, 237, 1);
      border-radius: 5px 5px 0 0;
      .select-all {
        font-size: 13px;
        padding: 14px;
      }
    }
    .tree {
      border: 1px solid rgba(228, 231, 237, 1);
      border-radius: 0 0 5px 5px;
      padding: 14px;
    }
  }
  .consult-right {
    .consult-list {
      .el-table {
        .el-icon-bottom,.el-icon-top{
          color: #409eff;
          padding-right: 6px;
        }
        .el-icon-delete{
          color: #F56C6C;
          padding-right: 6px;
        }
      }
    }
  }
}
</style>
<style lang="postcss">
.product-made-home {
  .left-box {
    .el-input__inner {
      border-radius: 16px;
    }
  }
}
</style>