<template>
  <div class="management-home-page">
    <div class="wrap-box">
      <div class="left-box">
        <div class="left-top-box">
          <div class="shifting-duty-wrap-box">
            <div class="title-text-box">
              <div class="bold-text">交接班</div>
              <router-link to="/integrated-management/duty-management/history">
                <div class="small-text" >历史交接班记录</div>
              </router-link>
            </div>
            <div class="step-box">
              <el-steps :active="active" finish-status="success" align-center class="step-big-box">
                <el-step :title="item.time" :description="item.name" v-for="(item,index) in stepList" :key="index"></el-step>
              </el-steps>
              <div class="right-icon" @click="dutyPop=true">
                <i class="iconfont jiaoban"></i>
                <div class="jiaoban-text">交班</div>
              </div>
            </div>
            <div class="table-box">
              <div class="table-title">交接班任务</div>
              <el-table :data="tableData" border style="width: 100%" :show-header="false">
                <el-table-column type="index" label="" width="40"></el-table-column>
                <el-table-column label="">
                  <template slot-scope="scope">
                    <div class="cell-box">
                      <span class="text">{{scope.row.content}}</span>
                      <div>
                        <el-button round size="small" class="color-F46D6A">应急</el-button>
                        <el-button round size="small" class="color-E6A23D">重大</el-button>
                      </div>
                    </div>
                  </template>
                </el-table-column>
              </el-table>
            </div>
          </div>
          <div class="duty-roster-wrap-box">
            <div class="title-text-box">
              <div class="bold-text">值班表</div>
              <router-link to="/integrated-management/duty-management/scheduling">
                <div class="small-text">值班管理</div>
              </router-link>
            </div>
            <div>
              <el-calendar>
                <template
                  slot="dateCell"
                  slot-scope="{date, data}">
                  <p :class="data.isSelected ? 'is-selected' : ''" @mouseover="allcalendar(data.day,$event)" @mouseout="dutyTablePop=!dutyTablePop">
                    {{ data.day.split('-').slice(2).join('-') }} {{ data.isSelected ? '' : ''}}
                  </p>
                  <div v-for="(item,index) in calendarData" :key="index" >
                    <div v-if="(item.months).indexOf(data.day.split('-').slice(1)[0])!=-1">
                      <div v-if="(item.days).indexOf(data.day.split('-').slice(2).join('-'))!=-1">
                            <div class="item" effect="dark" :content="item.things" placement="right">
                                <div class="name-style">{{item.things}}</div>
                            </div>
                        </div>
                      <div v-else></div>
                    </div>
                    <div v-else></div>
                  </div>
                </template>
              </el-calendar>
            </div>
          </div>
        </div>
        <div class="left-bottom-box">
          <div class="title-text-box">
            <div class="bold-text">综合管理</div>
          </div>
          <ul class="border-box">
              <li>
                <div class="title-text">值班管理</div>
                <div class="item-list">
                  <div class="icon-box" v-for="(item,index) in dutyList" :key="index">
                    <router-link :to="item.url">
                      <i class="iconfont" :class="item.icon" :style="{'color':item.color}"></i>
                      <div class="icon-text">{{item.text}}</div>
                    </router-link>
                  </div>
                </div>
              </li>
              <li>
                <div class="title-text">值班流程配置</div>
                <div class="item-list">
                  <div class="icon-box" v-for="(item,index) in process" :key="index">
                    <router-link :to="item.url">
                      <i class="iconfont" :class="item.icon" :style="{'color':item.color}"></i>
                      <div class="icon-text">{{item.text}}</div>
                    </router-link>
                  </div>
                </div>
              </li>
              <li>
                <div class="title-text">临时任务单</div>
                <div class="item-list">
                  <div class="icon-box" v-for="(item,index) in task" :key="index">
                    <router-link :to="item.url">
                      <i class="iconfont" :class="item.icon" :style="{'color':item.color}"></i>
                      <div class="icon-text">{{item.text}}</div>
                    </router-link>
                  </div>
                </div>
              </li>
              <li>
                <div class="title-text">工作留痕</div>
                <div class="item-list">
                  <div class="icon-box" v-for="(item,index) in remains" :key="index">
                    <router-link :to="item.url">
                      <i class="iconfont" :class="item.icon" :style="{'color':item.color}"></i>
                      <div class="icon-text">{{item.text}}</div>
                    </router-link>
                  </div>
                </div>
              </li>
            </ul>
        </div>
      </div>
      <div class="right-box">
        <div class="title-text-box monitoring-title-box">
          <div class="bold-text">值班流程监控提醒</div>
          <div class="small-text">管理</div>
        </div>
        <div class="block">
          <el-timeline>
            <el-timeline-item
              v-for="(activity, index) in activities"
              :key="index"
              :icon="activity.icon"
              :type="activity.type"
              :color="activity.color"
              :size="activity.size"
              :timestamp="activity.timestamp">
              {{activity.content}}
            </el-timeline-item>
          </el-timeline>
        </div>
      </div>
    </div>
    <!-- 交接班弹窗 -->
    <el-dialog title="交接班" :visible.sync="dutyPop" width="60%">
    </el-dialog>
    <!-- 值班表弹窗 -->
    <div class="duty-table-pop" v-show="dutyTablePop" ref="textPop">
       <el-table :data="dutyTable" border style="width: 100%" :show-header="false">
          <el-table-column prop="text" label=""  align="center"></el-table-column>
          <el-table-column prop="name" label="" align="center"></el-table-column>
        </el-table>
    </div>
  </div>
</template>

<script>
import {
requestIntegratedHoneHistoryList,
requestIntegratedHoneDutyList,
requestIntegratedHoneDutyTaskList
} from "@/common/remote/";
  export default {
    data() {
      return {
        active: 2,
        loginInfo:null,
        tableData: [{
          content: '上海市普陀区金沙江路 1518 弄'
        }, {
          content: '上海市普陀区金沙江路 1517 弄上海市普陀区金沙江路 1519 弄上海市普陀区金沙江路 1519 弄'
        }, {
          content: '上海市普陀区金沙江路 1519 弄'
        }, {
          content: '上海市普陀区金沙江路 1516 弄'
        }],
        dutyList:[
          {
            icon:"gangweiguanli",
            text:"岗位管理",
            color:"#5CAAE6",
            url:"/integrated-management/duty-management/post"
          },
          // {
          //   icon:"jiaoseguanli",
          //   text:"人员管理",
          //   color:"#7085E0",
          //   url:"/integrated-management/duty-management/personnel"
          // },
          {
            icon:"paibanguanli",
            text:"排班管理",
            color:"#4DBFB5",
            url:"/integrated-management/duty-management/scheduling"
          },
          {
            icon:"lishijiaojieban",
            text:"历史交接班",
            color:"#F5B562",
            url:"/integrated-management/duty-management/history"
          }
        ],
        process:[
          {
            icon:"renwupeizhi",
            text:"任务配置",
            color:"#50A5E6",
            url:"",
          },
          {
            icon:"liuchengtixinghejiankong",
            text:"流程提醒和监控",
            color:"#F5B562",
            url:"",
          }
        ],
        task:[
          {
            icon:"yingjixiangying",
            text:"应急响应",
            color:"#F58462",
            url:"",
          },
          {
            icon:"zhongdahuodong",
            text:"重大活动",
            color:"#7085E0",
            url:"",
          },
          {
            icon:"linshidaibanshixiang",
            text:"临时待办事项",
            color:"#4DBFB5",
            url:"",
          }
        ],
        remains:[
          {
            icon:"gongzuoliuhen",
            text:"工作留痕",
            color:"#5CAAE6",
            url:"",
          }
        ],
        activities: [{
          content: '短时临近预报修改',
          timestamp: '2018-04-12 20:46',
          size: 'large',
          type: 'primary',
          icon: 'el-icon-check',
          color:"#409EFF"
          }, {
            content: '周边城市预报',
            timestamp: '2018-04-03 20:46',
            color: '#67C241',
            icon:"el-icon-bell"
          }, {
            content: '周边城市报文',
            timestamp: '2018-04-03 20:46',
            size: 'large'
          }, {
            content: '城市预报气象网',
            timestamp: '2018-04-03 20:46'
          }, {
            content: '周边城市报文',
            timestamp: '2018-04-03 20:46',
            size: 'large'
          }, {
            content: '城市预报气象网',
            timestamp: '2018-04-03 20:46'
          }, {
            content: '周边城市报文',
            timestamp: '2018-04-03 20:46',
            size: 'large'
          }, {
            content: '查看智能网格预报业务平台',
            timestamp: '2018-04-03 20:46'
        }],
        recordPop:false,
        dutyPop:false,
        dutyTablePop:false,
        dutyTable:[
          {
            text:"气象台-副班",
            name:"张蔷"
          },
           {
            text:"气象台-主班",
            name:"王强"
          },
           {
            text:"应急服务岗",
            name:"刘勇"
          },
           {
            text:"值周领班岗",
            name:"张大壮"
          },
           {
            text:"专业台",
            name:"李晓亮"
          }
        ],
        scrollTop:"",
        calendarData: [
          { months: ['01'],days: ['30'],things: '看电影' },
          { months: ['02'], days: ['12'],things: '去公园' },
          { months: ['02'], days: ['13'],things: '看星星' },
          { months: ['02'], days: ['22'],things: '看月亮' }   
        ],
        stepList:[
          {
            time:"11:00",
            name:"韦丽群",
            success:"true"
          },
          {
            time:"12:00",
            name:"张帆",
            success:"true"
          },
          {
            time:"13:00",
            name:"韦丽群",
            success:"false"
          },{
            time:"14:00",
            name:"韦丽群",
            success:"false"
          },
          {
            time:"15:00",
            name:"韦丽群",
            success:"false"
          }
        ]
      }
    },
    methods: {
      allcalendar(day,e) {
        let vm = this;
        console.log(day)
        vm.dutyTablePop = true
        this.$refs.textPop.style.left = e.clientX + 50 + "px";
        this.$refs.textPop.style.top = e.clientY + "px";
      },
      handleScroll(e) {
        //监听滚动的距离
        this.scrollTop = e.target.scrollTop;
      },
    },
    mounted(){
      let vm = this;
      vm.loginInfo = JSON.parse(localStorage.getItem('loginInfo',))
      requestIntegratedHoneHistoryList().then(res => {
        this.tableData = res.data.list
      })
      requestIntegratedHoneDutyList({job_Id:vm.loginInfo.orgId}).then(res => {
        console.log(res)
      })
      requestIntegratedHoneDutyTaskList({job_Id:vm.loginInfo.orgId}).then(res => {
        console.log(res)
      })

      window.addEventListener("scroll", this.handleScroll, true);
    }
  }
</script>

<style scoped>
a{
  text-decoration: none;
}
.management-home-page{
  height: 100%;
  .wrap-box{
    display: flex;
    justify-content: space-between;
    background: #F6F6F6;
    height: 100%;
    padding:20px 15px;
    .left-box{
      flex: 1;
      .left-top-box{
        display: flex;
        margin-bottom:15px;
        .shifting-duty-wrap-box{
          flex: 1;
          margin-right: 15px;
          background: #fff;
          height: 520px;
          padding: 22px 31px;
          .step-box{
            margin-top: 48px;
            display: flex;
            .step-big-box{
              flex: 1;
              margin-top: 10px;
            }
            .right-icon{
              margin-left: 20px;
              width: 62px;
              height: 62px;
              border-radius: 50%;
              background: #409EFF;
              color: #fff;
              text-align: center;
              cursor: pointer;
              .jiaoban{
                font-size: 32px;
              }
              .jiaoban-text{
                font-size: 14px;
              }
            }
          }
          .table-box{
            margin-top: 0px;
            .table-title{
              font-size:16px;
              font-family:Microsoft YaHei;
              font-weight:300;
              color:rgba(72,72,72,1);
              text-align: center;
              margin-bottom:10px;
            }
            .cell-box{
              display: flex;
              justify-content: space-between;
              .text{
                font-size: 14px;
                flex: 1;
                margin-right: 10px;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
                display: inline-block;
                height: 25px;
              }

            }
          }
        }
        .duty-roster-wrap-box{
          flex: 1;
          background: #fff;
          height: 520px;
          padding: 22px 31px;
          overflow: hidden;
          .item{
            font-size:14px;
            color:#606266;
            margin-top:45px;
          }
         
        }
      }
      .left-bottom-box{
        background: #fff;
        padding: 22px 31px;
        .border-box{
          padding: 0;
          margin:0;
          border: 1px solid #ddd;
          border-radius:4px;
          margin-top:15px;
          display: flex;
          justify-content: space-between;
          li{
            list-style: none;
            width: 25%;
            border-right: 1px solid #ddd;
            .title-text{
              height: 60px;
              line-height: 60px;
              border-bottom: 1px solid #ddd;
              text-align: center;
            }
            .item-list{
              display: flex;
              flex-wrap: wrap;
              padding: 22px 15px;
              .icon-box{
                width: 33.3%;
                text-align: center;
                .iconfont{
                  font-size: 32px;
                }
                .icon-text{
                  font-size:14px;
                  font-family:Microsoft YaHei;
                  font-weight:400;
                  color:rgba(144,147,153,1);
                  margin-top:10px;
                }
              }
              .icon-box:nth-child(3n){
                margin-bottom:40px;
              }
            }
          }
          li:last-child{
            border-right: none;
          }
        }
      }
    }
    .right-box{
      width: 303px;
      background: #fff;
      margin-left: 15px;
    }
  }
  .title-text-box{
    display: flex;
    justify-content: space-between;
    .bold-text{
      font-size:18px;
      font-family:Microsoft YaHei;
      font-weight:bold;
      color:rgba(72,72,72,1);
    }
    .small-text{
      font-size:14px;
      font-family:Microsoft YaHei;
      font-weight:400;
      color:rgba(144,147,153,1);
      cursor: pointer;
    }
  }
  .monitoring-title-box{
    padding:20px 13px 20px 31px;
    border: 1px solid #EBEEF5;
    margin-bottom:25px;
  }
  .color-F46D6A{
    border-color:#F46D6A!important;
    color: #F46D6A!important; 
    padding: 5px 10px;
  }
  .color-E6A23D{
    border-color:#E6A23D!important;
    color: #E6A23D!important; 
    padding: 5px 10px;
  }
  .duty-table-pop{
    position: absolute;
    background: #fff;
    width: 240px;
    border:1px solid rgba(64, 158, 255, 1); 
    padding: 30px 20px;
  }
}

</style>
<style>
  .management-home-page{
    .el-step__icon{
      width: 10px;
      height: 10px;
      background: #ddd;
      border-color: #ddd;
    }
    .el-step__icon-inner{
      color: #ddd;
    }
    .el-step__description{
      position: relative;
      top: -75px;
    }
    .el-step__head.is-success{
      color: #ddd;
      border-color: #ddd;
    }
    .el-step__title.is-success {
      color: #ddd;
    }
    .el-step__title.is-process,.el-step__description.is-process{
       color: #67C241;
    }
    .is-process .el-step__icon{
      background: #67C241;
      border-color: #67C241;
    }
    .is-process .el-step__icon-inner{
      color: #67C241;
    }
    .el-step__description.is-success{
      color: #606266;
    }
    .el-timeline-item__node--large {
      left: -5px;
      width: 20px;
      height: 20px;
    }
    .el-timeline-item__node--normal {
      left: -4px;
      width: 20px;
      height: 20px;
    }
    .el-calendar-table .el-calendar-day{
      text-align: center;
      height: 60px;
    }
    .el-calendar-table .el-calendar-day p{
      margin: 0;
      padding:0;
      font-size: 18px;
      display: inline-block;
      height: 100%;
      width: 100%;
      text-align: center;
    }
    .el-calendar-table td.is-today {
      color: #606266;
      background: #F5F7FA;
    }
    .el-timeline-item{
      margin-left: 100px;
    }
    .el-timeline-item__timestamp {
      position: relative;
      left: -150px;
      top: -20px;
    }
  }
</style>